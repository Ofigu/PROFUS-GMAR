<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All holdings of coins by customers</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      text-align: center;
      padding: 8px;
    }

    thead {
      background-color: #f2f2f2;
    }

    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .search-container {
      margin-bottom: 20px;
    }

    .search-container input {
      margin-right: 10px;
    }

    .formatted-date {
      white-space: nowrap;
    }

    .formatted-number {
      display: inline-block;
    }

  </style>
</head>

<body>
  <h1>All Holdings of Coins by Customers</h1>

  <div class="search-container">
    <label for="searchUser">Search by User Name:</label>
    <input type="text" id="searchUser" placeholder="Enter user name...">
    
    <label for="searchName">Search by Coin Name:</label>
    <input type="text" id="searchName" placeholder="Enter coin name...">

    <label for="searchValue">Search by Value:</label>
    <input type="number" id="searchValue" placeholder="Enter value...">
  </div>

  <table>
    <thead>
      <tr>
        <th>User Name</th>
        <th>Coin Name</th>
        <th>Amount</th>
        <th>Value</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="tradeTableBody">
      <!-- Trades will be dynamically added here -->
    </tbody>
  </table>

  <script>
    // Make a request to the server and fetch the trades data
    fetch('/alltrades')
      .then(response => response.json())
      .then(data => {
        // Sort the trades by Value in descending order
        data.sort((a, b) => b.Value - a.Value);

        const tradeTableBody = document.getElementById('tradeTableBody');
        const searchNameInput = document.getElementById('searchName');
        const searchValueInput = document.getElementById('searchValue');
        const searchUserInput = document.getElementById('searchUser');

        const filterTrades = () => {
          const searchName = searchNameInput.value.toLowerCase();
          const searchValue = searchValueInput.value;
          const searchUser = searchUserInput.value.toLowerCase();

          const filteredTrades = data.filter(trade => {
            const tradeName = trade.CoinName.toLowerCase();
            const tradeValue = trade.Value;
            const tradeUser = trade.UserName.toLowerCase();

            return tradeName.includes(searchName) &&
              (!searchValue || tradeValue <= searchValue) &&
              tradeUser.includes(searchUser);
          });

          renderTrades(filteredTrades);
        };

        const renderTrades = (trades) => {
          tradeTableBody.innerHTML = '';
          trades.forEach(trade => {
            const row = document.createElement('tr');
            const formattedDate = new Date(trade.LastDate).toLocaleString();
            const parts = parseFloat(trade.Value).toFixed(2).split(".");
            const formattedValue = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",") + (parts[1] ? "." + parts[1] : "");

            row.innerHTML = `
              <td>${trade.UserName}</td>
              <td>${trade.CoinName}</td>
              <td>${trade.Amount}</td>
              <td><span class="formatted-number">${formattedValue}</span></td>
              <td><span class="formatted-date">${formattedDate}</span></td>
            `;
            tradeTableBody.appendChild(row);
          });
        };

        searchNameInput.addEventListener('input', filterTrades);
        searchValueInput.addEventListener('input', filterTrades);
        searchUserInput.addEventListener('input', filterTrades);

        renderTrades(data);
      })
      .catch(error => console.error('Error:', error));
  </script>
</body>

</html>